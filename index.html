<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>QR生成と投稿</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    .selectGroup {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .selectGroup > div {
      flex: 1 1 200px;
    }
  </style>
</head>
<body>

  <h1>QRコード生成ツール</h1>

  <!-- QRコードを生成するボタン -->
  <button onclick="generateQRCode()">① QRコードを生成する</button>

  <!-- QRコード表示領域 -->
  <div id="qrcode" style="margin-top: 1rem;"></div>

  <!-- セレクトボックス -->
  <div class="selectGroup" style="margin-top: 1rem;">  
        <div>
            <strong>回避率</strong>
            <select id="avoidanceSelect">
                <option value="">選択してください</option>
                <option value="回避0">回避0</option>
                <option value="回避3+">回避3+</option>
                <option value="回避3-">回避3-</option>
                <option value="回避6">回避6</option>
                <option value="回避10">回避10</option>
                <option value="回避15">回避15</option>
            </select>
        </div>
        <div>
            <strong>体格</strong>
            <select id="physiqueSelect">
                <option value="">選択してください</option>
                <option value="最速">最速</option>
                <option value="準速">準速</option>
                <option value="中間">中間</option>
                <option value="準大">準大</option>
                <option value="最大">最大</option>
            </select>
        </div>
        <div>
            <strong>色</strong>
            <select id="colorSelect">
                <option value="">選択してください</option>
                <option value="黒">黒</option>
                <option value="赤">赤</option>
                <option value="青">青</option>
                <option value="黄">黄</option>
                <option value="橙">橙</option>
                <option value="緑">緑</option>
                <option value="水">水</option>
                <option value="紫">紫</option>
                <option value="白">白</option>
                <option value="薄黒">薄黒</option>
                <option value="薄赤">薄赤</option>
                <option value="薄青">薄青</option>
                <option value="薄黄">薄黄</option>
                <option value="薄橙">薄橙</option>
                <option value="薄緑">薄緑</option>
                <option value="薄水">薄水</option>
                <option value="薄紫">薄紫</option>
                <option value="薄白">薄白</option>
                <option value="濃黒">濃黒</option>
                <option value="濃赤">濃赤</option>
                <option value="濃青">濃青</option>
                <option value="濃黄">濃黄</option>
                <option value="濃橙">濃橙</option>
                <option value="濃緑">濃緑</option>
                <option value="濃水">濃水</option>
                <option value="濃紫">濃紫</option>
                <option value="濃白">濃白</option>
            </select>
        </div>
        <div>
            <strong>頭</strong>
            <select id="headSelect">
                <option value="">選択してください</option>
                <option value="横楕円">横楕円</option>
                <option value="石鹼">石鹼</option>
                <option value="丸">丸</option>
                <option value="三角">三角</option>
                <option value="四角">四角</option>
                <option value="縦楕円">縦楕円</option>
            </select>
        </div>
        <div>
            <strong>アンテナ</strong>
            <select id="antennaSelect">
                <option value="">選択してください</option>
                <option value="アンテナなし">アンテナなし</option>
                <option value="ふっかつ">ふっかつ</option>
                <option value="かいふく">かいふく</option>
                <option value="むてき">むてき</option>
                <option value="よけにくい">よけにくい</option>
                <option value="ノックダウン">ノックダウン</option>
                <option value="なおす">なおす</option>
                <option value="ぞくせいなおす">ぞくせいなおす</option>
                <option value="こうふん">こうふん</option>
                <option value="あしもとガード">あしもとガード</option>
                <option value="おそくなれ">おそくなれ</option>
                <option value="よわくなれ">よわくなれ</option>
                <option value="やわくなれ">やわくなれ</option>
                <option value="はやくなれ">はやくなれ</option>
                <option value="つよくなれ">つよくなれ</option>
                <option value="かたくなれ">かたくなれ</option>
                <option value="かわしやすい">かわしやすい</option>
                <option value="どくになれ">どくになれ</option>
                <option value="めかくし">めかくし</option>
                <option value="しびれさせる">しびれさせる</option>
                <option value="ねむらせる">ねむらせる</option>
                <option value="げどく">げどく</option>
                <option value="しびれとる">しびれとる</option>
                <option value="めざめる">めざめる</option>
                <option value="単体火">単体火</option>
                <option value="単体水">単体水</option>
                <option value="単体電気">単体電気</option>
                <option value="単体土">単体土</option>
                <option value="単体風">単体風</option>
                <option value="単体氷">単体氷</option>
                <option value="単体闇">単体闇</option>
                <option value="単体光">単体光</option>
                <option value="3体火">3体火</option>
                <option value="3体水">3体水</option>
                <option value="3体電気">3体電気</option>
                <option value="3体土">3体土</option>
                <option value="3体風">3体風</option>
                <option value="3体氷">3体氷</option>
                <option value="3体風">3体闇</option>
                <option value="3体風">3体光</option>
                
            </select>
        </div>
        <div>
            <strong>特徴</strong>
            <select id="featureSelect">
                <option value="">選択してください</option>
                <option value="親子">親子</option>
                <option value="双子">双子</option>
                <option value="顔素材">顔素材</option>
                <option value="かわいい">かわいい</option>
                <option value="かっこいい">かっこいい</option>
                <option value="髪素材">髪素材</option>
                <option value="眉素材">眉素材</option>
                <option value="目素材">目素材</option>
                <option value="鼻素材">鼻素材</option>
                <option value="口素材">口素材</option>
                <option value="顔色素材">顔色素材</option>
            </select>
        </div>
  </div>

  <!-- 掲示板に飛ぶボタン（QRコードが生成された後に表示） -->
  <button id="toBBS" style="margin-top: 1rem; display: none;" onclick="uploadAndRedirect()">
    ② 掲示板に飛ぶ
  </button>

  <script>
    let qrGenerated = false;

    function generateQRCode() {
      // 既存のQRコード削除
      document.getElementById("qrcode").innerHTML = "";

      // QRコードに入れる文字列（例：ランダムな英数字16文字）
      const text = Array.from({ length: 16 }, () =>
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(Math.random() * 62))
      ).join("");

      // QRコード生成
      new QRCode(document.getElementById("qrcode"), {
        text: text,
        width: 256,
        height: 256
      });

      qrGenerated = true;

      // 掲示板ボタン表示
      document.getElementById("toBBS").style.display = "inline-block";
    }

    function uploadAndRedirect() {
      if (!qrGenerated) {
        alert("先にQRコードを生成してください！");
        return;
      }

      const img = document.querySelector("#qrcode img");
      if (!img) {
        alert("QRコード画像が見つかりません！");
        return;
      }

      const imageData = img.src.replace(/^data:image\/png;base64,/, "");

      // 各セレクトボックスの値を取得
      const getValue = id => document.getElementById(id)?.value || "";
      const params = {
        avoidance: getValue("avoidanceSelect"),
        physique: getValue("physiqueSelect"),
        color: getValue("colorSelect"),
        head: getValue("headSelect"),
        antenna: getValue("antennaSelect"),
        feature: getValue("featureSelect")
      };

      // クエリにまとめる
      const query = new URLSearchParams(params).toString();

      // ImgBBにアップロード（APIキーを自分のものに）
      const apiKey = "84fd930a069e7e066eb94ca8eb8a491a"; // ←ここを自分のキーに変更
      fetch("https://api.imgbb.com/1/upload?key=" + apiKey, {
        method: "POST",
        body: new URLSearchParams({ image: imageData })
      })
        .then(res => res.json())
        .then(data => {
          const imageUrl = encodeURIComponent(data.data.url);
          window.location.href = `bbs.html?image=${imageUrl}&${query}`;
        })
        .catch(err => {
          console.error("アップロード失敗", err);
          alert("QRコードのアップロードに失敗しました。");
        });
    }
  </script>

</body>
</html>
